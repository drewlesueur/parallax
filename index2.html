<!doctype html>
<html>
  <head>
  <meta name="viewport" content="initial-scale = 1.0, user-scalable = no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Kingdomland</title>
  <script src="zepto.js"></script>
  <style>
    * { margin: 0; padding: 0}
  </style>
  </head>
  <body>
    <div id="f" style="position:fixed">0</div>
    <div id="bg" style="background-color: teal; height: 5000px; width:300px;" >
      <div id="w" style="position: absolute; top: 100px; font-size: 50px; font-family: helvetica; font-weight: bold;">WOA5</div>

    </div>

  </body>
  <script>
    var compare = function (a, b) {
      if (a == b) {
        return 0;
      } else if (a < b) {
        return -1
      } else {
        return 1 
      }
    }
   easingMaker = function(x2, y2, x3, y3) {
      var x1, x4, y1, y4, _ref;
      _ref = [0, 0, 1, 1], x1 = _ref[0], y1 = _ref[1], x4 = _ref[2], y4 = _ref[3];
      return function(t) {
        var newX;
        newX = cubed(1 - t) * x1 + 3 * squared(1 - t) * t * x2 + 3 * (1 - t) * squared(t) * x3 + cubed(t) + x4;
        return newX - 1;
      };
    };

    defaultEasing = easingMaker(0, 1, 1, 0);
    testEasing = function() {
      var ii, _results;
      _results = [];
      for (ii = 0; ii < 10; ii++) {
        _results.push(console.log("easing test " + (defaultEasing(ii / 10))));
      }
      return _results;
    }; 


    var closestSortedSearch = function (arr, start, end, ret, func, compareator) {
      
      var length = (end - start) + 1
      if (length <= 1) {
        return [start, arr[start]]
      }

      var mid = start + Math.floor(length / 2)
      var item = arr[mid]
      var match = compareator(ret, func(item))
      if (match == 0) {
        return [mid, item]
      } else if (match > 0) {
        return closestSortedSearch(arr, mid + 1, end, ret, func, compareator)         
      } else if (match < 0) {
        return closestSortedSearch(arr, start, mid - 1, ret,  func, compareator)         
      }

    }

    list = [1,3,500, 899, 900]
    found = closestSortedSearch(list, 0, list.length - 1, 600, function (x) {return x}, compare)
    console.log(found)
    var story = 
      [{
        "face": {
          transform: "0, 0"
        },
        "time": 0
      }
      , {
        "face": {
          transform: "100px, 0"
        },
        "time": 100
      }]

    var touch = {}
    var scrollIndex = 0


    var findClosestPropertyInPast = function (arr, prop, index) {
      for (var i = index; i >= 0; i--) {
        var page = arr[i]
        if (property in page) {
          return [, arr[i]]
        }
      } 
    }

    var dashboard = $("#f")
    var getPageTime = function(page) {return page.time}
    var render = function (_scrollIndex) {
      // dashboard.text(_scrollIndex)
      keyFrame = closestSortedSearch(story, 0, story.length - 1, _scrollIndex, getPageTime, compare )     
      
      var keyFrameIndex = keyFrame[0]
      var keyFrameData = keyFrame[1]
      var property = "transform"
      // var startKeyFrame = findclosestPropertyInPast(story, property, keyFrameIndex) 
      var i = _scrollIndex
      $("#w").css("-webkit-transform", "translate("+i+"px, 0)")


    }


    var touchstart = function (e) {
      e.preventDefault()
      touch.y1 = e.touches[0].pageY
    }

    //https://github.com/drewlesueur/mobile/blob/server/public/index.js
    var touchmove = function  (e) {
      touch.y2 = e.touches[0].pageY
      render(scrollIndex + touch.y2 - touch.y1)   
      e.preventDefault()
    }

    var touchend = function (e) {
      scrollIndex = scrollIndex + touch.y2 - touch.y1
    } 


    $(document).ready(function () {
      $(document.body).bind("touchstart", touchstart)
      $(document.body).bind("touchmove", touchmove)
      $(document.body).bind("touchend", touchend)
    })
  </script>
</html>

